<%= render "shared/form_card",
    icon: "users",
    title: "Select Players",
    description: "Choose which players are participating in this session. You can select multiple players.",
    current_step: 2,
    total_steps: 3 do %>

  <%= form_with model: [@table, @game_session], class: "space-y-6", data: { controller: "form" } do %>
    <%= hidden_field_tag :game_format_id, params[:game_format_id] %>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <% @available_players.each do |player| %>
        <div class="relative">
          <%= check_box_tag "player_ids[]", player.id, false,
              class: "peer absolute opacity-0",
              id: dom_id(player, :select) %>
          
          <label for="<%= dom_id(player, :select) %>"
              class="block bg-primary-800/50 backdrop-blur-sm rounded-xl border border-primary-700/50 p-4 
                     cursor-pointer peer-checked:border-secondary-400 peer-checked:ring-1 peer-checked:ring-secondary-400
                     hover:border-primary-600/50 transition-colors duration-200">
            <div class="flex items-center space-x-4">
              <%# Avatar %>
              <div class="flex items-center justify-center w-12 h-12 text-2xl 
                          bg-primary-800/50 rounded-lg border border-primary-700/50">
                <%= player.emoji %>
              </div>

              <%# Player Info %>
              <div>
                <h3 class="text-primary-50 font-mono font-bold"><%= player.name %></h3>
                <% if player.notes.present? %>
                  <p class="text-primary-400 text-sm font-mono mt-1"><%= player.notes %></p>
                <% end %>
              </div>
            </div>
          </label>
        </div>
      <% end %>
    </div>

    <div class="flex justify-between items-center mt-6">
      <%= link_to "Back", select_format_table_game_sessions_path(@table),
          class: "px-4 py-2 rounded-lg font-mono text-primary-400 hover:text-primary-50 hover:bg-primary-800/50" %>
      
      <%= button_tag type: :submit,
          class: "px-4 py-2 rounded-lg font-mono text-primary-900 bg-secondary-400 
                 hover:bg-secondary-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",
          data: { form_target: "submit" } do %>
        Continue
      <% end %>
    </div>
  <% end %>
<% end %>
